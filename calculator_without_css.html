<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Calculator</title>
</head>
<body>
  <h2>Simple Calculator</h2>
  <p>Enter a mathematical expression and click "Calculate" to see the result.</p>

  <input id="expr" type="text" placeholder="Calculate here"/>
  <button id="evalBtn">Calculate</button>
  <button id="clearBtn">C</button>
  <div id="result">Result will appear here</div>

  <script>
    function tokenize(s) {
      const tokens = [];
      const reNumber = /^[0-9]+(\.[0-9]+)?/;
      s = s.replace(/\s+/g,'');
      let i = 0;
      while(i < s.length) {
        const ch = s[i];
        if(ch==='(' || ch===')'){ tokens.push(ch); i++; continue; }
        if(/[+\-*/%^]/.test(ch)){
          if(ch==='-'){
            const prev = tokens.length ? tokens[tokens.length-1] : null;
            if(prev===null || prev==='(' || /[+\-*/%^]/.test(prev)){ tokens.push('u-'); i++; continue; }
          }
          tokens.push(ch); i++; continue;
        }
        const rest = s.slice(i);
        const m = rest.match(reNumber);
        if(m){ tokens.push(m[0]); i+=m[0].length; continue; }
        throw new Error('Invalid character: '+ch);
      }
      return tokens;
    }

    function toRPN(tokens){
      const out=[], ops=[];
      const prec={'u-':4,'^':3,'*':2,'/':2,'%':2,'+':1,'-':1};
      const rightAssoc={'^':true,'u-':true};
      for(const token of tokens){
        if(!isNaN(token)) out.push(token);
        else if(token in prec){
          while(ops.length){
            const top = ops[ops.length-1];
            if(top==='(') break;
            const pTop = prec[top], pTok=prec[token];
            if(pTop>pTok || (pTop===pTok && !rightAssoc[token])) out.push(ops.pop());
            else break;
          }
          ops.push(token);
        } else if(token==='(') ops.push(token);
        else if(token===')'){
          while(ops.length && ops[ops.length-1]!=='(') out.push(ops.pop());
          if(!ops.length || ops.pop()!=='(') throw new Error('Mismatched parentheses');
        } else throw new Error('Unknown token: '+token);
      }
      while(ops.length){
        const t=ops.pop();
        if(t==='('||t===')') throw new Error('Mismatched parentheses');
        out.push(t);
      }
      return out;
    }

    function evalRPN(rpn){
      const stack=[];
      for(const tok of rpn){
        if(!isNaN(tok)) stack.push(Number(tok));
        else if(tok==='u-'){ if(stack.length<1) throw new Error('Invalid unary'); stack.push(-stack.pop()); }
        else{
          if(stack.length<2) throw new Error('Invalid expression');
          const b=stack.pop(), a=stack.pop();
          let res;
          switch(tok){
            case '+': res=a+b; break;
            case '-': res=a-b; break;
            case '*': res=a*b; break;
            case '/': if(b===0) throw new Error('Division by zero'); res=a/b; break;
            case '%': if(b===0) throw new Error('Division by zero'); res=a%b; break;
            case '^': res=Math.pow(a,b); break;
            default: throw new Error('Unknown operator: '+tok);
          }
          stack.push(res);
        }
      }
      if(stack.length!==1) throw new Error('Invalid expression');
      return stack[0];
    }

    function evaluateExpression(input){
      if(!input || !input.trim()) throw new Error('Empty expression');
      return evalRPN(toRPN(tokenize(input)));
    }

    const exprInput=document.getElementById('expr');
    const resDiv=document.getElementById('result');
    const evalBtn=document.getElementById('evalBtn');
    const clearBtn=document.getElementById('clearBtn');

    function showResult(value){ resDiv.textContent=value; }
    function showError(msg){ resDiv.textContent='Error: '+msg; }

    evalBtn.addEventListener('click', ()=>{
      try{
        const out = evaluateExpression(exprInput.value);
        showResult(Number.isInteger(out)? out : parseFloat(out.toPrecision(12)));
      }catch(e){ showError(e.message||e); }
    });

    clearBtn.addEventListener('click', ()=>{
      exprInput.value='';
      resDiv.textContent='Result will appear here';
    });

    exprInput.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){ evalBtn.click(); e.preventDefault(); }
    });

    // Placeholder disappear/reappear
    exprInput.addEventListener('focus', () => { exprInput.placeholder = ''; });
    exprInput.addEventListener('blur', () => { if(exprInput.value==='') exprInput.placeholder='Calculate here'; });
  </script>
</body>
</html>
